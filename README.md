# Chat With Debug Diva

#### **LLM对话框组件** 

此项目demo版与其他成员一同完成，源地址https://github.com/JINLING1/DebugDiva


后续将在本仓库进行进一步改进。

#### 启动方式

```
npm run dev
```

### 项目简介

------

本项目是一个支持文本、图片、PDF输入及流式响应展示的多模式对话框组件，支持流式响应，集成 Coze API 实现大模型对话功能。

当前已实现功能：

1. 支持**多种输入形式**：允许用户上传文本、图片、PDF等，并确保不同格式的数据能够正确解析和展示。
2. **流式返回**：支持大模型逐步返回内容，提供平滑的逐行打印体验。
3. **Markdown 渲染**：确保 LLM 返回的 Markdown 语法正确解析，提升可读性和用户体验。
4. **代码展示与复制功能**：对代码片段进行美观展示，并提供回复内容一键复制功能和代码复制功能，方便用户使用。
5. **内联对话框**：对话在当前界面展开，用户可查看历史对话内容，可以快速反馈（中止，重新加载）。首页展示收缩形态，第一次发送消息后，触发展开形态，进入对话空间。

### 技术方案

------

| 技术类别     | 选型方案    |
| ------------ | ----------- |
| 前端框架     | Vue3        |
| 大模型API    | Coze API    |
| 代码高亮     | Prism.js    |
| 复制功能     | ClipboardJS |
| Markdown渲染 | Markdown-it |
| 构建工具     | Vite        |

### 组件及框架设计部分

------

##### **1. 布局结构**

- 采用 Element-Plus 的栅格布局，左侧为历史数据表格（宽度占6列），右侧为聊天主界面（宽度占18列）。  
- 左侧表格高度占满容器，支持滚动。  
- 右侧聊天界面分为 Header（标题）、Main（聊天内容滚动区）、Footer（输入框及操作按钮）。  

##### **2. 左侧表格功能**

- **数据存储**：使用 `localStorage` 持久化表格数据（`tableData`）
- **交互功能**：  
  - 悬浮展示行详情（`el-popover` 显示 `work` 和 `date`）。  
  - 支持行内编辑（`el-input` 动态替换按钮，限制输入10字符）和删除操作。  
  - 编辑保存后更新时间为当前时间戳。  

##### **3. 右侧聊天功能**

- **输入与提交**：  
  - 支持多行输入（Shift+Enter换行），限制1000字符。  
  - 点击 `Send` 或 按下 Enter 触发 `handleSearch`，调用聊天API。  
  - 消息生成过程中，`Send`变为`Pause`，可终止生成，此时可修改输入框内容，再次重新提交。
  - 点击`Refresh`按钮，重新提交用户输入，并返回新回复。
- **流式响应**：  
  - 实时拼接 API 返回的流数据（`processStreamedData`），通过 `streamedOutput` 动态更新聊天记录。 
  - 用户消息和助手消息样式区分（背景色和位置）。  
  - 流式返回结束后，清空输入框，用户可再次提问。

##### **4. 文件上传模块**

- 限制文件大小（图片 10MB 以内，其他文件 20MB 以内，在`handleFileChange` 中校验）。  
- 上传后调用 `https://api.coze.cn/v1/files/upload` 接口，返回的文件 ID 绑定到 `file.url`。  
- 文件列表展示在输入框上方，支持删除（`handleFileDelete`）。    

##### **5. 关键细节**

- **API 集成**：使用 `fetch` 与后端交互，请求头包含固定 Token。  
- **样式优化**：  
  - 聊天内容区域自动换行（`white-space: pre-line`）。  
  - 输入框圆角设计（`border-radius: 20px`）。  
  - 表格操作按钮绝对定位（避免行高变化影响布局）。
  - 聊天框根据内容自适应宽度（`width:fit-content`）
  - 聊天助手头像与聊天框以弹性的方式排列对齐（`display: flex`）
  - 等待回复返回过程中，显示动态加载圆圈（`class="loading-spinner"`）

##### **6. Markdown渲染与图片展示模块**

- **支持标准的Markdown语法**
  - 代码渲染：支持代码块的显示，格式化不同编程语言的代码。
  - 表格渲染：采用`markdown-it-multimd-table`插件渲染表格，能够正确渲染表格中的文本和数据。
  - 文本渲染：通过 Vue 的 `v-for` 指令循环渲染消息列表（`message`），确保每条消息都能独立渲染。
- **图片展示**
  - 通过`isImageMessage()`来判断传递的消息是否包含图片链接。若包含，设定`isImage`为`true`，添加`img`元素。
  - 通过`extractImageUrl()`提取图片链接，再通过正则化将其转化为markdown格式。
  - 绑定`bigger()`方法，通过`isBigger`属性来控制图片的放大和缩小效果。
- **代码复制：**提供了复制代码功能，简化了用户与代码的互动。

##### 7.不同分辨率下的布局适配

- 布局适配
  - 弹性布局实现内容区域自动适应填充剩余空间。
  - 通过媒体查询实现屏幕适应。

##### 8.**内联对话框模式**

- **动态用户界面交互**
  - 组件支持收缩、展开两种视图状态。
  - 状态间的转换过程平滑且无卡顿，同时界面能够持久化用户最后选择的视图状态。
- **前端动画与过渡管理**
  - 采用Vue框架的transition组件或同等技术手段来控制界面的动画和过渡效果。
  - 通过不同视图状态间切换时的动画处理，提升了用户体验并确保界面的动态表现符合设计规范。

### 运行展示

------

![](\images\shousuo.png)

![](\images\expand.png)

![](\images\wenjian.png)

